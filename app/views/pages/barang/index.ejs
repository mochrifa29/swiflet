<div class="p-6">
  <!-- Tombol Tambah -->
  <div class="flex justify-between items-center mt-6">
    <h1 class="text-2xl font-semibold"><%= title %></h1>
    <a
      href="/barang/create"
      class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
    >
      <svg data-lucide="plus" class="w-5 h-5"></svg>
      Tambah
    </a>
  </div>

  <!-- Tabel -->
  <div class="mt-4 bg-white shadow rounded-lg p-4">
    <table class="w-full text-left">
      <thead class="bg-gray-100 text-gray-700 uppercase text-sm">
        <tr>
          <th class="p-3">#</th>
          <th class="p-3">Name</th>
          <th class="p-3">Grade</th>
          <th class="p-3">Foto</th>
          <th class="p-3 text-center">Aksi</th>
        </tr>
      </thead>
      <tbody>
         <% if (barang.length === 0) { %>
          <tr>
              <td colspan="3" class="text-center p-3 text-gray-500">
                Data tidak ada
              </td>
          </tr>
        <% } else { %>
        <% barang.forEach((b, i) => { %>
          <tr 
            class="border-b hover:bg-gray-50" 
            x-data="{ 
              id: '<%= b._id %>', 
              nama: '<%= b.nama_barang %>',
              grade: '<%= b.grade %>' 
            }"
            @barang-terupdate.window="
              if ($event.detail.id === id) {
                nama = $event.detail.nama;
                grade = $event.detail.grade;
              }
              "
            >
              <td class="p-3"><%= i + 1 %></td>

              <td class="p-3">
                <button 
                  @click="$dispatch('edit', { id, nama, grade })"
                  class="hover:underline cursor-pointer"
                  x-text="nama"
                ></button>
              </td>

              <td class="p-3">
                <button 
                  @click="$dispatch('edit', { id, nama, grade })"
                  class="hover:underline cursor-pointer"
                  x-text="grade"
                ></button>
              </td>
              <td class="p-3">
                <a href="/barang/detail/<%= b._id %>">
                  <% if (b.foto) { %>
                    <img src="<%= b.foto %>" class="w-16 h-16 object-cover rounded-md" />
                  <% } else { %>
                    <span class="text-gray-400">Tidak ada foto</span>
                  <% } %>
                </a>
              </td>

              <td class="p-3 text-center">
                <a
                  href="/barang/delete/<%= b._id %>"
                  onclick="return confirm('Yakin hapus?');"
                  class="text-red-600 hover:text-red-800"
                >
                  <svg data-lucide="trash" class="w-5 h-5"></svg>
                </a>
              </td>
          </tr>

         <% }) %>

        <% } %>
      </tbody>
    </table>
  </div>

</div>


<!-- modal -->
 <!-- Modal -->
<div 
  id="modalEditNama"
  x-data="editNamaModal()" 
  x-show="open"
  @edit.window="show($event.detail.id, $event.detail.nama, $event.detail.grade)"
  x-transition.opacity
  class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50"
>
  <div class="bg-white p-6 rounded-lg w-96 shadow-lg" @click.outside="close()">

    <h2 class="text-xl font-semibold mb-3">Edit Barang</h2>

    <!-- Nama -->
    <label class="text-sm text-gray-600">Nama Barang</label>
    <input
      x-model="nama"
      class="w-full border border-gray-300 rounded-md px-3 py-2 mb-4"
    />

    <!-- Grade -->
    <label class="text-sm text-gray-600">Grade</label>
    <input
      x-model="grade"
      class="w-full border border-gray-300 rounded-md px-3 py-2"
    />

    <div class="flex justify-end mt-4 gap-2">
      <button @click="close()" class="px-4 py-2 bg-gray-200 rounded-md">
        Tutup
      </button>
      
      <button 
        @click="save()" 
        class="px-4 py-2 bg-blue-600 text-white rounded-md"
      >
        Simpan
      </button>
    </div>

  </div>
</div>



<script>
function editNamaModal() {
  return {
    open: false,
    id: null,
    nama: "",
    grade: "",

    show(id, nama, grade) {
      this.id = id;
      this.nama = nama;
      this.grade = grade;
      this.open = true;
    },

    close() {
      this.open = false;
    },

    async save() {
      const body = {
        nama_barang: this.nama,
        grade: this.grade
      };

      await fetch(`/barang/update/${this.id}`, {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      // Update tampilan tabel tanpa reload
      window.dispatchEvent(
        new CustomEvent("barang-terupdate", {
          detail: { id: this.id, nama: this.nama, grade: this.grade }
        })
      );

      this.close();
    }
  };
}
</script>













