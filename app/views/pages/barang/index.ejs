<div x-data="{ openAdd:false, openEdit:false, openDelete:false }" class="p-6">
  <!-- Tombol Tambah -->
  <div class="flex justify-between items-center mt-6">
    <h1 class="text-2xl font-semibold"><%= title %></h1>
    <a
      href="/barang/create"
      class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
    >
      <svg data-lucide="plus" class="w-5 h-5"></svg>
      Tambah
    </a>
  </div>

  <!-- Tabel -->
  <div class="mt-4 bg-white shadow rounded-lg p-4">
    <table class="w-full text-left">
      <thead class="bg-gray-100 text-gray-700 uppercase text-sm">
        <tr>
          <th class="p-3">#</th>
          <th class="p-3">Name</th>
          <th class="p-3">Grade</th>
          <th class="p-3">Foto</th>
          <th class="p-3 text-center">Aksi</th>
        </tr>
      </thead>
      <tbody>
         <% if (barang.length === 0) { %>
          <tr>
              <td colspan="3" class="text-center p-3 text-gray-500">
                Data tidak ada
              </td>
          </tr>
        <% } else { %>
        <% barang.forEach((b, i) => { %>
          <tr class="border-b hover:bg-gray-50" x-data="inlineEditBarang('<%= b._id %>', '<%= b.nama_barang %>', <%= b.harga %>)">
            <td class="p-3"><%= i + 1 %></td>
            <td class="p-3">
              <template x-if="!editingNama">
                <span @click="editingNama = true" class="cursor-pointer" x-text="nama"></span>
              </template>
              <template x-if="editingNama">
                  <div class="flex items-center gap-2">
                    <!-- Input -->
                    <input 
                      x-model="nama" 
                      class="border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-indigo-400 focus:outline-none transition"
                      placeholder="Nama Barang"
                    />

                    <!-- Tombol Simpan -->
                    <button 
                      @click="save('nama')" 
                      class="inline-flex items-center px-3 py-1 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700 transition"
                    >
                      Simpan
                    </button>

                    <!-- Tombol Batal -->
                    <button 
                      @click="cancel('nama')" 
                      class="inline-flex items-center px-3 py-1 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200 transition"
                    >
                      Batal
                    </button>
                  </div>
              </template>

            </td>
            <td class="p-3">
              <%= b.grade %>
            </td>
            <td class="p-3">
               <a href="/barang/detail/<%= b._id %>">
                  <% if (b.foto) { %>
                    <img 
                    src="<%= b.foto %>" 
                    alt="Foto <%= b.nama_barang %>" 
                    class="w-16 h-16 object-cover rounded-md"
                  
                    "/>
                  <% } else { %>
                    <span class="text-gray-400 text-sm">Tidak ada foto</span>
                  <% } %>
               </a>
            </td>
            <td class="p-3">
              <div class="flex items-center justify-center gap-3">
               

                <!-- Delete -->
                <a
                  href="/barang/delete/<%= b._id %>" 
                   onclick="return confirm('Apakah anda yakin ingin menghapus barang ini?');"
                  class="text-red-600 hover:text-red-800"
                >
                  <svg data-lucide="trash" class="w-5 h-5"></svg>
                </a>
              </div>
            </td>
          </tr>
         <% }) %>

        <% } %>
      </tbody>
    </table>
  </div>

  




</div>
  
</div>



<script>
function inlineEditBarang(id, namaInit, hargaInit) {
  return {
    nama: namaInit,
    editingNama: false,
    originalNama: namaInit,
    save(field) {
      // Siapkan data
      const data = {};
      if (field === 'nama') data.nama_barang = this.nama;

      fetch(`/barang/update/${id}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(result => {
        if (result.success) {
          if (field === 'nama') {
            this.originalNama = this.nama;
            this.editingNama = false;
          }
        } else {
          alert(result.message);
        }
      })
      .catch(err => alert('Error: ' + err));
    },
    cancel(field) {
      if (field === 'nama') this.nama = this.originalNama; this.editingNama = false;
      
    }
  }
}
</script>




