<div
  class="p-6"
  x-data="printModal()"
>
  <!-- Tombol Tambah -->
  <div class="flex justify-between items-center mt-6">
    <h1 class="text-2xl font-semibold"><%= title %></h1>
    <a
      href="/transaksi/create"
      class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
    >
      <svg data-lucide="plus" class="w-5 h-5"></svg>
      Tambah
    </a>
  </div>

  <!-- Tabel -->
  <div class="mt-4 bg-white shadow rounded-lg p-4">
    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead class="bg-gray-100 text-gray-700 uppercase text-sm">
          <tr>
            <th class="p-3">#</th>
            <th class="p-3">Invoice</th>
            <th class="p-3">Name</th>
            <th class="p-3">Total Berat</th>
            <th class="p-3">Total Belanja</th>
            <th class="p-3">Keterangan</th>
            <th class="p-3">Action</th>
          </tr>
        </thead>
        <tbody>
          <% if (transaksi.length === 0) { %>
            <tr>
                <td colspan="3" class="text-center p-3 text-gray-500">
                  Data tidak ada
                </td>
            </tr>
          <% } else { %>
          <% transaksi.forEach((t, i) => { %>
            <%
              const formatter = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 });
            %>
              <tr class="border-b hover:bg-gray-50">
                <td class="p-3"><%= i + 1 %></td>
                <td class="p-3"><%= t.invoice %></td>
                <td class="p-3"><%= t.nama_pembeli %></td>
                <td class="p-3"><%= Intl.NumberFormat('id-ID').format(t.total_berat) %> Gram</td>
                <td class="p-3"><%= Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(t.total_belanja) %></td>
                <td class="p-3"><%= t.keterangan %></td>
                <td class="p-3" x-data="detailModal">
                  <div class="flex items-center justify-center gap-3">
                    <a
                      href="/transaksi/detail/<%= t._id %>"
                      class="text-blue-600 hover:text-blue-800"
                    >
                      <svg data-lucide="eye" class="w-5 h-5"></svg>
                    </a>

                    <a
                      @click='showPrintModal({
                              id: "<%= t._id %>",
                              invoice: "<%= t.invoice %>",
                              nama_pembeli: "<%= t.nama_pembeli %>",
                              total_berat: <%= t.total_berat %>,
                              total_belanja: <%= t.total_belanja %>,
                              bayar: <%= t.bayar %>,
                              kembalian: <%= t.kembalian %>,
                              items: <%- JSON.stringify(t.items) %>,
                              tanggal: "<%= t.createdAt.toLocaleDateString("id-ID") %>",
                              waktu : "<%= t.createdAt.toLocaleTimeString("id-ID") %>"
                              })'
                      class="text-green-600 hover:text-green-800 cursor-pointer"
                    >
                      <svg data-lucide="printer" class="w-5 h-5"></svg>
                    </a>
                  </div>

                </td>
                
              </tr>

          <% }) %>

          <% } %>
        </tbody>
      </table>
    </div>
  </div>

<!-- Modal Struk -->
<div
  x-show="openPrint"
  x-transition.opacity
  class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50"
>
  <div
    class="bg-white w-[340px] rounded-lg shadow-xl border border-gray-300 p-5 text-[12px] text-black"
    @click.outside="openPrint = false"
  >

    <!-- Header -->
    <div class="text-center pb-3 border-b border-gray-300">
      <h2 class="font-bold text-sm tracking-wide text-black">TOKO WALET JAYA</h2>
      <p class="text-[11px] text-black">Jl. Mawar No. 123</p>
      <p class="text-[11px] text-black">Telp: 0812-3456-7890</p>
    </div>

    <!-- Info -->
    <div class="mt-3 space-y-1 leading-tight">

      <div class="flex justify-between">
        <span class="font-semibold text-[11px]" x-text="data.invoice"></span>
      </div>

      <div class="flex justify-between">
        <span class="text-[11px]">Tanggal</span>
        <span class="font-semibold text-[11px]" x-text="data.tanggal"></span>
      </div>

      <div class="flex justify-between">
        <span class="text-[11px]">Waktu</span>
        <span class="font-semibold text-[11px]" x-text="data.waktu"></span>
      </div>

      <div class="flex justify-between">
        <span class="text-[11px]">Pembeli</span>
        <span class="font-semibold text-[11px]" x-text="data.nama_pembeli"></span>
      </div>

    </div>

    <hr class="my-3 border-gray-300">

    <!-- Items -->
    <div class="space-y-1">
      <template x-for="i in data.items">
        <div class="flex justify-between text-[12px]">
          <span x-text="i.name"></span>
          <span class="font-semibold" x-text="new Intl.NumberFormat('id-ID').format(i.sub_total)"></span>
        </div>
      </template>
    </div>

    <hr class="my-3 border-gray-300">

    <!-- Total -->
    <div class="space-y-1 text-[12px]">

      <div class="flex justify-between font-bold">
        <span>Total</span>
        <span x-text="new Intl.NumberFormat('id-ID').format(data.total_belanja)"></span>
      </div>

      <div class="flex justify-between">
        <span>Bayar</span>
        <span class="font-semibold" x-text="new Intl.NumberFormat('id-ID').format(data.bayar)"></span>
      </div>

      <div class="flex justify-between">
        <span>Kembalian</span>
        <span class="font-semibold" x-text="new Intl.NumberFormat('id-ID').format(data.kembalian)"></span>
      </div>
    </div>

    <hr class="my-3 border-gray-300">

    <p class="text-center text-[11px] text-black">
      Terima kasih telah berbelanja!
    </p>

  </div>
</div>






</div>



<script>
function printModal() {
  return {
    openPrint: false,
    data: {},

    showPrintModal(transaksi) {
      this.data = transaksi;
      this.openPrint = true;
    }
  }
}
</script>




